<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Taipei Metro Map Viewer</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* ป้องกันการเลือกข้อความและไฮไลท์สีฟ้าบนมือถือ */
        body {
            -webkit-tap-highlight-color: transparent;
            touch-action: none;
        }
    </style>
</head>
<body class="bg-sky-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- Inline Icons (แทนการใช้ Lucide-react เพื่อให้ไฟล์เดียวจบ) ---
        const Cloud = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17.5 19c0-1.7-1.3-3-3-3h-1.1c-.1-1.3-.6-2.5-1.5-3.4-.9-.9-2.1-1.3-3.4-1.3-2.6 0-4.8 2.1-4.9 4.7C1.6 16.5 0 18.6 0 21h18c1.7 0 3-1.3 3-3 0-.4-.1-.8-.3-1.2"/></svg>
        );
        const ImageIcon = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
        );
        const Home = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        );
        const Minus = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/></svg>
        );
        const Plus = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
        );
        const RotateCcw = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
        );

        const App = () => {
            const [imageSrc, setImageSrc] = useState('https://res.cloudinary.com/dbeuu3lmv/image/upload/v1768753679/metrotaipeimap_tn_kv1gmn.jpg');
            const [scale, setScale] = useState(1);
            const [position, setPosition] = useState({ x: 0, y: 0 });
            const [isDragging, setIsDragging] = useState(false);
            const [dragStart, setDragStart] = useState({ x: 0, y: 0 });
            const [lastTouchDistance, setLastTouchDistance] = useState(null);
            
            const containerRef = useRef(null);

            // --- Logic การคำนวณระยะห่างนิ้ว (Pinch Zoom) ---
            const getDistance = (touches) => {
                return Math.hypot(
                touches[0].clientX - touches[1].clientX,
                touches[0].clientY - touches[1].clientY
                );
            };

            // ฟังก์ชันซูม
            const handleZoom = (delta) => {
                setScale((prevScale) => {
                const newScale = prevScale + delta;
                return Math.min(Math.max(newScale, 0.2), 6); 
                });
            };

            const resetView = () => {
                setScale(1);
                setPosition({ x: 0, y: 0 });
            };

            // --- Mouse Events ---
            const handleMouseDown = (e) => {
                setIsDragging(true);
                setDragStart({ x: e.clientX - position.x, y: e.clientY - position.y });
            };

            const handleMouseMove = (e) => {
                if (!isDragging) return;
                e.preventDefault();
                setPosition({ x: e.clientX - dragStart.x, y: e.clientY - dragStart.y });
            };

            const handleMouseUp = () => {
                setIsDragging(false);
            };

            const handleWheel = (e) => {
                const scaleAdjustment = -e.deltaY * 0.001;
                setScale((prevScale) => Math.min(Math.max(prevScale + scaleAdjustment, 0.2), 6));
            };

            // --- Touch Events ---
            const handleTouchStart = (e) => {
                if (e.touches.length === 1) {
                setIsDragging(true);
                setDragStart({
                    x: e.touches[0].clientX - position.x,
                    y: e.touches[0].clientY - position.y,
                });
                } else if (e.touches.length === 2) {
                setIsDragging(false);
                setLastTouchDistance(getDistance(e.touches));
                }
            };

            const handleTouchMove = (e) => {
                if (e.touches.length === 1 && isDragging) {
                setPosition({
                    x: e.touches[0].clientX - dragStart.x,
                    y: e.touches[0].clientY - dragStart.y,
                });
                } 
                else if (e.touches.length === 2) {
                const currentDistance = getDistance(e.touches);
                if (lastTouchDistance) {
                    const delta = currentDistance / lastTouchDistance;
                    setScale((prev) => Math.min(Math.max(prev * delta, 0.2), 6)); 
                    setLastTouchDistance(currentDistance);
                }
                }
            };

            const handleTouchEnd = () => {
                setIsDragging(false);
                setLastTouchDistance(null);
            };

            return (
                <div className="flex flex-col h-screen bg-sky-300 font-sans text-slate-800 overflow-hidden relative selection:bg-yellow-200">
                
                {/* Background Decor (Clouds) */}
                <div className="absolute top-10 left-10 text-white/40 animate-pulse pointer-events-none">
                    <Cloud size={100} className="fill-current" />
                </div>
                <div className="absolute bottom-20 right-10 text-white/30 animate-pulse pointer-events-none delay-700">
                    <Cloud size={120} className="fill-current" />
                </div>
                <div className="absolute top-1/2 left-1/4 text-white/20 pointer-events-none">
                    <Cloud size={80} className="fill-current" />
                </div>

                {/* Header */}
                <header className="bg-white/90 backdrop-blur-md shadow-lg border-b-4 border-yellow-400 p-3 z-30 flex justify-between items-center relative">
                    <div className="flex items-center gap-3">
                    <div className="bg-blue-500 p-2 rounded-2xl border-2 border-blue-600 shadow-sm transform -rotate-3 text-white">
                        <ImageIcon size={24} />
                    </div>
                    <div>
                        <h1 className="text-xl md:text-2xl font-black text-blue-600 tracking-tight" style={{ textShadow: '1px 1px 0px #fff' }}>
                        TAIPEI <span className="text-red-500">METRO</span>
                        </h1>
                    </div>
                    </div>
                    
                    <a 
                    href="https://surakit2538.github.io/taiwan2026/"
                    className="flex items-center gap-2 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-full font-bold shadow-[0_4px_0_rgb(185,28,28)] active:shadow-none active:translate-y-[4px] transition-all border-2 border-red-600 no-underline"
                    >
                    <Home size={20} />
                    <span className="hidden sm:inline">Back Home</span>
                    </a>
                </header>

                {/* Main Area */}
                <main className="flex-1 relative overflow-hidden flex items-center justify-center z-10">
                    
                    <div 
                    ref={containerRef}
                    className="w-full h-full cursor-move overflow-hidden relative flex items-center justify-center touch-none"
                    onMouseDown={handleMouseDown}
                    onMouseMove={handleMouseMove}
                    onMouseUp={handleMouseUp}
                    onMouseLeave={handleMouseUp}
                    onWheel={handleWheel}
                    onTouchStart={handleTouchStart}
                    onTouchMove={handleTouchMove}
                    onTouchEnd={handleTouchEnd}
                    >
                    <div
                        style={{
                        transform: `translate(${position.x}px, ${position.y}px) scale(${scale})`,
                        transition: isDragging || lastTouchDistance ? 'none' : 'transform 0.15s cubic-bezier(0.1, 0.7, 1.0, 0.1)',
                        transformOrigin: 'center',
                        willChange: 'transform',
                        }}
                        className="absolute shadow-2xl rounded-lg border-8 border-white bg-white"
                    >
                        <img 
                        src={imageSrc} 
                        alt="Taipei Metro Map" 
                        className="max-w-none pointer-events-none select-none"
                        style={{ maxWidth: 'initial' }}
                        draggable={false}
                        />
                    </div>
                    </div>

                    {/* Controls */}
                    <div className="absolute bottom-8 left-1/2 transform -translate-x-1/2 flex items-center gap-3 z-40 bg-white/80 backdrop-blur rounded-3xl p-3 border-4 border-white shadow-xl">
                    
                    <button 
                        onClick={() => handleZoom(-0.25)}
                        className="w-12 h-12 flex items-center justify-center bg-yellow-400 hover:bg-yellow-500 text-yellow-900 rounded-full shadow-[0_4px_0_rgb(202,138,4)] active:shadow-none active:translate-y-[4px] transition-all border-2 border-yellow-500"
                    >
                        <Minus size={24} />
                    </button>
                    
                    <div className="bg-blue-100 px-4 py-2 rounded-xl border-2 border-blue-200 min-w-[80px] text-center">
                        <span className="text-lg font-black text-blue-500">
                        {Math.round(scale * 100)}%
                        </span>
                    </div>

                    <button 
                        onClick={resetView}
                        className="w-12 h-12 flex items-center justify-center bg-red-400 hover:bg-red-500 text-white rounded-full shadow-[0_4px_0_rgb(185,28,28)] active:shadow-none active:translate-y-[4px] transition-all border-2 border-red-500"
                        title="รีเซ็ต"
                    >
                        <RotateCcw size={24} />
                    </button>

                    <button 
                        onClick={() => handleZoom(0.25)}
                        className="w-12 h-12 flex items-center justify-center bg-green-400 hover:bg-green-500 text-green-900 rounded-full shadow-[0_4px_0_rgb(21,128,61)] active:shadow-none active:translate-y-[4px] transition-all border-2 border-green-600"
                    >
                        <Plus size={24} />
                    </button>
                    </div>

                    {/* Hint Bubble */}
                    <div className="absolute top-4 left-1/2 transform -translate-x-1/2 pointer-events-none animate-bounce z-0 opacity-80">
                    <div className="bg-white px-4 py-2 rounded-2xl shadow-md border-2 border-sky-200 text-sky-600 text-xs font-bold text-center">
                        ใช้นิ้วเลื่อน หรือ ขยายได้เลย!
                        <div className="absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-white rotate-45 border-b-2 border-r-2 border-sky-200"></div>
                    </div>
                    </div>

                </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>