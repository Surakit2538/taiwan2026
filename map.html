<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Taipei Metro Map Viewer</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* ล็อคหน้าจอแบบสมบูรณ์ ป้องกันการเลื่อนและเด้ง */
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* ปิด Scrollbar ของ Browser */
            overscroll-behavior: none; /* ปิด Effect เด้งๆ บน iOS */
            -webkit-tap-highlight-color: transparent;
            touch-action: none; /* บังคับให้ Browser ไม่จัดการ Touch Event เอง */
        }

        #root {
            width: 100%;
            height: 100%;
        }

        /* Animation ลอยไปมาของก้อนเมฆ */
        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            50% { transform: translateY(-15px) translateX(8px); }
        }
        .animate-float {
            animation: float 7s ease-in-out infinite;
        }
        .animate-float-slow {
            animation: float 11s ease-in-out infinite;
        }
        .animate-float-delayed {
            animation: float 9s ease-in-out infinite;
            animation-delay: 2s;
        }
        
        /* เพิ่มความฟุ้งให้เงาของเมฆ */
        .cloud-shadow {
            filter: drop-shadow(4px 4px 0px rgba(0,0,0,0.1));
        }
    </style>
</head>
<body class="bg-[#87CEEB]"> <!-- สีฟ้าท้องฟ้า -->
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- Inline Icons ---
        
        // Cloud แบบใหม่: สร้างจากวงกลมหลายวงซ้อนกัน เพื่อความกลมมนที่สุด (Andy's Room Style)
        const Cloud = ({ size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size * 0.6} 
                viewBox="0 0 100 60" 
                fill="currentColor" 
                className={`${className} cloud-shadow`}
            >
                {/* ฐานเมฆ */}
                <rect x="20" y="35" width="60" height="20" rx="10" />
                {/* ก้อนซ้าย */}
                <circle cx="25" cy="40" r="18" />
                {/* ก้อนกลางใหญ่สุด */}
                <circle cx="50" cy="28" r="24" />
                {/* ก้อนขวา */}
                <circle cx="78" cy="38" r="16" />
                {/* เติมเต็มช่องว่าง */}
                <circle cx="65" cy="35" r="15" />
                <circle cx="35" cy="35" r="15" />
            </svg>
        );

        const Home = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        );
        const Minus = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/></svg>
        );
        const Plus = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
        );
        const RotateCcw = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
        );

        const App = () => {
            const [imageSrc, setImageSrc] = useState('https://res.cloudinary.com/dbeuu3lmv/image/upload/v1768753679/metrotaipeimap_tn_kv1gmn.jpg');
            const [scale, setScale] = useState(1);
            const [position, setPosition] = useState({ x: 0, y: 0 });
            const [isDragging, setIsDragging] = useState(false);
            const [dragStart, setDragStart] = useState({ x: 0, y: 0 });
            const [lastTouchDistance, setLastTouchDistance] = useState(null);
            
            const containerRef = useRef(null);

            // --- Logic การคำนวณระยะห่างนิ้ว (Pinch Zoom) ---
            const getDistance = (touches) => {
                return Math.hypot(
                touches[0].clientX - touches[1].clientX,
                touches[0].clientY - touches[1].clientY
                );
            };

            // ฟังก์ชันซูม
            const handleZoom = (delta) => {
                setScale((prevScale) => {
                const newScale = prevScale + delta;
                return Math.min(Math.max(newScale, 0.2), 6); 
                });
            };

            const resetView = () => {
                setScale(1);
                setPosition({ x: 0, y: 0 });
            };

            // --- Mouse Events ---
            const handleMouseDown = (e) => {
                setIsDragging(true);
                setDragStart({ x: e.clientX - position.x, y: e.clientY - position.y });
            };

            const handleMouseMove = (e) => {
                if (!isDragging) return;
                e.preventDefault();
                setPosition({ x: e.clientX - dragStart.x, y: e.clientY - dragStart.y });
            };

            const handleMouseUp = () => {
                setIsDragging(false);
            };

            const handleWheel = (e) => {
                const scaleAdjustment = -e.deltaY * 0.001;
                setScale((prevScale) => Math.min(Math.max(prevScale + scaleAdjustment, 0.2), 6));
            };

            // --- Touch Events ---
            const handleTouchStart = (e) => {
                if (e.touches.length === 1) {
                setIsDragging(true);
                setDragStart({
                    x: e.touches[0].clientX - position.x,
                    y: e.touches[0].clientY - position.y,
                });
                } else if (e.touches.length === 2) {
                setIsDragging(false);
                setLastTouchDistance(getDistance(e.touches));
                }
            };

            const handleTouchMove = (e) => {
                if (e.touches.length === 1 && isDragging) {
                // ไม่ต้อง preventDefault ที่นี่เพราะ touch-action: none จัดการให้แล้ว
                // และเพื่อประสิทธิภาพที่ดีขึ้น
                setPosition({
                    x: e.touches[0].clientX - dragStart.x,
                    y: e.touches[0].clientY - dragStart.y,
                });
                } 
                else if (e.touches.length === 2) {
                const currentDistance = getDistance(e.touches);
                if (lastTouchDistance) {
                    const delta = currentDistance / lastTouchDistance;
                    setScale((prev) => Math.min(Math.max(prev * delta, 0.2), 6)); 
                    setLastTouchDistance(currentDistance);
                }
                }
            };

            const handleTouchEnd = () => {
                setIsDragging(false);
                setLastTouchDistance(null);
            };

            return (
                <div className="flex flex-col h-full w-full bg-[#87CEEB] font-sans text-slate-800 relative selection:bg-yellow-200">
                
                {/* Background Decor (Clouds - Style Toy Story) */}
                {/* เมฆชุดที่ 1: ซ้ายบน */}
                <div className="absolute top-[8%] left-[5%] text-white/95 animate-float pointer-events-none">
                    <Cloud size={160} className="fill-current" />
                </div>
                
                {/* เมฆชุดที่ 2: ขวากลาง */}
                <div className="absolute top-[35%] right-[8%] text-white/90 animate-float-slow pointer-events-none">
                    <Cloud size={200} className="fill-current" />
                </div>
                
                {/* เมฆชุดที่ 3: ซ้ายล่าง */}
                <div className="absolute bottom-[12%] left-[10%] text-white/90 animate-float-delayed pointer-events-none">
                    <Cloud size={140} className="fill-current" />
                </div>

                 {/* เมฆชุดที่ 4: ขวาบนไกลๆ */}
                 <div className="absolute top-[5%] right-[25%] text-white/60 animate-float pointer-events-none">
                    <Cloud size={90} className="fill-current" />
                </div>
                
                {/* เมฆชุดที่ 5: เล็กๆ แทรก */}
                <div className="absolute bottom-[25%] right-[30%] text-white/50 animate-float-slow pointer-events-none">
                    <Cloud size={70} className="fill-current" />
                </div>


                {/* Header */}
                <header className="bg-white/90 backdrop-blur-md shadow-lg border-b-4 border-yellow-400 p-3 z-30 flex justify-between items-center relative">
                    <div className="flex items-center gap-3">
                    {/* เปลี่ยนจากกล่องสีฟ้า เป็นรูปโลโก้ */}
                    <img 
                        src="https://res.cloudinary.com/dbeuu3lmv/image/upload/v1768744718/LOGO1_u8zacw.png" 
                        alt="Logo" 
                        className="h-14 w-auto drop-shadow-md transform -rotate-6 hover:rotate-0 transition-transform duration-300" 
                    />
                    <div>
                        <h1 className="text-xl md:text-2xl font-black text-blue-600 tracking-tight" style={{ textShadow: '1px 1px 0px #fff' }}>
                        TAIPEI <span className="text-red-500">METRO</span>
                        </h1>
                    </div>
                    </div>
                    
                    <a 
                    href="https://surakit2538.github.io/taiwan2026/"
                    className="flex items-center gap-2 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-full font-bold shadow-[0_4px_0_rgb(185,28,28)] active:shadow-none active:translate-y-[4px] transition-all border-2 border-red-600 no-underline"
                    >
                    <Home size={20} />
                    <span className="hidden sm:inline">Back Home</span>
                    </a>
                </header>

                {/* Main Area */}
                <main className="flex-1 relative overflow-hidden flex items-center justify-center z-10 w-full h-full">
                    
                    <div 
                    ref={containerRef}
                    className="w-full h-full cursor-move relative flex items-center justify-center touch-none"
                    onMouseDown={handleMouseDown}
                    onMouseMove={handleMouseMove}
                    onMouseUp={handleMouseUp}
                    onMouseLeave={handleMouseUp}
                    onWheel={handleWheel}
                    onTouchStart={handleTouchStart}
                    onTouchMove={handleTouchMove}
                    onTouchEnd={handleTouchEnd}
                    >
                    <div
                        style={{
                        transform: `translate(${position.x}px, ${position.y}px) scale(${scale})`,
                        transition: isDragging || lastTouchDistance ? 'none' : 'transform 0.15s cubic-bezier(0.1, 0.7, 1.0, 0.1)',
                        transformOrigin: 'center',
                        willChange: 'transform',
                        }}
                        className="absolute shadow-2xl rounded-lg border-8 border-white bg-white"
                    >
                        <img 
                        src={imageSrc} 
                        alt="Taipei Metro Map" 
                        className="max-w-none pointer-events-none select-none"
                        style={{ maxWidth: 'initial' }}
                        draggable={false}
                        />
                    </div>
                    </div>

                    {/* Controls */}
                    <div className="absolute bottom-8 left-1/2 transform -translate-x-1/2 flex items-center gap-3 z-40 bg-white/80 backdrop-blur rounded-3xl p-3 border-4 border-white shadow-xl">
                    
                    <button 
                        onClick={() => handleZoom(-0.25)}
                        className="w-12 h-12 flex items-center justify-center bg-yellow-400 hover:bg-yellow-500 text-yellow-900 rounded-full shadow-[0_4px_0_rgb(202,138,4)] active:shadow-none active:translate-y-[4px] transition-all border-2 border-yellow-500"
                    >
                        <Minus size={24} />
                    </button>
                    
                    <div className="bg-blue-100 px-4 py-2 rounded-xl border-2 border-blue-200 min-w-[80px] text-center">
                        <span className="text-lg font-black text-blue-500">
                        {Math.round(scale * 100)}%
                        </span>
                    </div>

                    <button 
                        onClick={resetView}
                        className="w-12 h-12 flex items-center justify-center bg-red-400 hover:bg-red-500 text-white rounded-full shadow-[0_4px_0_rgb(185,28,28)] active:shadow-none active:translate-y-[4px] transition-all border-2 border-red-500"
                        title="รีเซ็ต"
                    >
                        <RotateCcw size={24} />
                    </button>

                    <button 
                        onClick={() => handleZoom(0.25)}
                        className="w-12 h-12 flex items-center justify-center bg-green-400 hover:bg-green-500 text-green-900 rounded-full shadow-[0_4px_0_rgb(21,128,61)] active:shadow-none active:translate-y-[4px] transition-all border-2 border-green-600"
                    >
                        <Plus size={24} />
                    </button>
                    </div>

                    {/* Hint Bubble */}
                    <div className="absolute top-4 left-1/2 transform -translate-x-1/2 pointer-events-none animate-bounce z-0 opacity-80">
                    <div className="bg-white px-4 py-2 rounded-2xl shadow-md border-2 border-sky-200 text-sky-600 text-xs font-bold text-center">
                        ใช้นิ้วเลื่อน หรือ ขยายได้เลย!
                        <div className="absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-white rotate-45 border-b-2 border-r-2 border-sky-200"></div>
                    </div>
                    </div>

                </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
